// é¦–é¡µ - é€‰æ‹©æ¨¡å¼
import { router } from '@kit.ArkUI';
import { CHAT_MODES } from '../constants/Modes';
import { ChatMode, Advisor } from '../models/ChatModels';

@Entry
@Component
struct HomePage {
  @State modes: ChatMode[] = CHAT_MODES;

  build() {
    Column() {
      // æ ‡é¢˜åŒºåŸŸ
      Column() {
        Row() {
          Column() {
            Text('é€‰æ‹©ä½ çš„é¡¾é—®å›¢')
              .fontSize(32)
              .fontWeight(FontWeight.Bold)
              .fontColor('#FFFFFF')
              .margin({ bottom: 8 })

            Text('ä¸åŒé£æ ¼ï¼ŒåŒæ ·å¸®ä½ è§£å†³é—®é¢˜')
              .fontSize(16)
              .fontColor('#B0B0B0')
              .opacity(0.8)
          }
          .layoutWeight(1)
          .alignItems(HorizontalAlign.Start)

          Button('æµ‹è¯•')
            .fontSize(14)
            .height(36)
            .backgroundColor('#ff6b6b')
            .onClick(() => {
              router.pushUrl({ url: 'pages/NetworkTestPage' });
            })
        }
        .width('100%')
      }
      .width('100%')
      .padding({ top: 60, bottom: 40, left: 20, right: 20 })

      // æ¨¡å¼é€‰æ‹©å¡ç‰‡
      Scroll() {
        Column({ space: 20 }) {
          ForEach(this.modes, (mode: ChatMode) => {
            this.ModeCard(mode)
          })

          // åŠŸèƒ½ç‰¹æ€§
          this.FeaturesSection()
        }
        .width('100%')
        .padding({ left: 20, right: 20, bottom: 40 })
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#1a1a2e')
  }

  @Builder
  ModeCard(mode: ChatMode) {
    Column() {
      // å›¾æ ‡å’Œæ ‡é¢˜
      Row() {
        Text(mode.icon)
          .fontSize(48)
          .margin({ right: 16 })

        Column({ space: 4 }) {
          Text(mode.name)
            .fontSize(22)
            .fontWeight(FontWeight.Bold)
            .fontColor('#FFFFFF')

          Text(mode.description)
            .fontSize(14)
            .fontColor('#B0B0B0')
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1)
      }
      .width('100%')
      .padding({ bottom: 16 })

      // é¡¾é—®åˆ—è¡¨
      Column({ space: 8 }) {
        ForEach(mode.advisors, (advisor: Advisor) => {
          Row() {
            Text(advisor.avatar)
              .fontSize(20)
              .margin({ right: 8 })

            Text(advisor.name)
              .fontSize(14)
              .fontColor('#FFFFFF')
          }
          .width('100%')
        })
      }
      .width('100%')
      .padding({ top: 12, bottom: 12 })
      .borderWidth({ top: 1 })
      .borderColor('rgba(255,255,255,0.1)')

      // å¼€å§‹æŒ‰é’®
      Button(mode.id === 'emperor' ? 'å¼€å§‹é—®ç­–' : 'å¼€å§‹å–ç»')
        .width('100%')
        .height(44)
        .fontSize(15)
        .fontWeight(FontWeight.Medium)
        .backgroundColor(mode.id === 'emperor' ? '#667eea' : '#f5576c')
        .borderRadius(22)
        .margin({ top: 8 })
    }
    .width('100%')
    .padding(24)
    .backgroundColor('rgba(255,255,255,0.05)')
    .borderRadius(20)
    .border({ width: 1, color: 'rgba(255,255,255,0.1)' })
    .onClick(() => {
      interface RouterParams {
        modeId: string;
        modeName: string;
      }

      const params: RouterParams = {
        modeId: mode.id,
        modeName: mode.name
      };

      router.pushUrl({
        url: 'pages/ChatPage',
        params: params
      });
    })
  }

  @Builder
  FeaturesSection() {
    Column({ space: 16 }) {
      Row({ space: 16 }) {
        this.FeatureCard('ğŸ¯', 'é—®é¢˜æ‹†è§£', 'å¤šè§’è‰²å¸®ä½ åˆ†æé—®é¢˜æœ¬è´¨')
        this.FeatureCard('ğŸ’¬', 'æƒ…ç»ªæ”¯æŒ', 'ä¸åªç»™æ–¹æ¡ˆï¼Œä¹Ÿç»™ä½ æƒ…ç»ªä»·å€¼')
      }
      .width('100%')

      Column() {
        this.FeatureCard('âœ…', 'è¡ŒåŠ¨æ¸…å•', 'ç»™å‡ºå¯æ‰§è¡Œçš„å…·ä½“å»ºè®®')
      }
      .width('100%')
    }
    .width('100%')
    .margin({ top: 40 })
  }

  @Builder
  FeatureCard(icon: string, title: string, desc: string) {
    Column({ space: 8 }) {
      Text(icon)
        .fontSize(28)

      Text(title)
        .fontSize(15)
        .fontWeight(FontWeight.Medium)
        .fontColor('#FFFFFF')

      Text(desc)
        .fontSize(12)
        .fontColor('#B0B0B0')
        .textAlign(TextAlign.Center)
    }
    .layoutWeight(1)
    .padding(20)
    .backgroundColor('rgba(255,255,255,0.05)')
    .borderRadius(16)
  }
}
