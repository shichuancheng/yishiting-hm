// é¦–é¡µ - å¾®ä¿¡é£æ ¼
import { router } from '@kit.ArkUI';
import { CHAT_MODES } from '../constants/Modes';
import { ChatMode, Advisor } from '../models/ChatModels';

@Entry
@Component
struct HomePage {
  @State modes: ChatMode[] = CHAT_MODES;

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Text('é€‰æ‹©é¡¾é—®')
          .fontSize(17)
          .fontWeight(FontWeight.Medium)
          .fontColor('#000000')
      }
      .width('100%')
      .height(48)
      .justifyContent(FlexAlign.Center)
      .backgroundColor('#EDEDED')
      .border({ width: { bottom: 0.5 }, color: '#D9D9D9' })

      // æ¨¡å¼åˆ—è¡¨
      Scroll() {
        Column({ space: 0 }) {
          // é¡¶éƒ¨è¯´æ˜
          Column() {
            Text('é€‰æ‹©é€‚åˆä½ çš„é¡¾é—®å›¢')
              .fontSize(13)
              .fontColor('#888888')
          }
          .width('100%')
          .padding({ left: 16, top: 16, bottom: 8 })

          // æ¨¡å¼å¡ç‰‡åˆ—è¡¨
          Column() {
            ForEach(this.modes, (mode: ChatMode, index: number) => {
              this.ModeItem(mode, index === this.modes.length - 1)
            })
          }
          .width('100%')
          .backgroundColor('#FFFFFF')
          .borderRadius(8)
          .margin({ left: 12, right: 12 })

          // åŠŸèƒ½ç‰¹æ€§
          this.FeaturesSection()
        }
        .width('100%')
        .padding({ bottom: 40 })
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
      .backgroundColor('#EDEDED')
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#EDEDED')
  }

  @Builder
  ModeItem(mode: ChatMode, isLast: boolean) {
    Column() {
      Row() {
        // å›¾æ ‡
        Column() {
          Text(mode.icon)
            .fontSize(36)
        }
        .width(56)
        .height(56)
        .backgroundColor('#F7F7F7')
        .borderRadius(8)
        .justifyContent(FlexAlign.Center)

        // ä¿¡æ¯
        Column({ space: 4 }) {
          Text(mode.name)
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#000000')

          Text(mode.description)
            .fontSize(13)
            .fontColor('#888888')
            .maxLines(1)
            .textOverflow({ overflow: TextOverflow.Ellipsis })

          // é¡¾é—®å¤´åƒè¡Œ
          Row({ space: 4 }) {
            ForEach(mode.advisors.slice(0, 4), (advisor: Advisor) => {
              Text(advisor.avatar)
                .fontSize(14)
            })
            if (mode.advisors.length > 4) {
              Text(`+${mode.advisors.length - 4}`)
                .fontSize(11)
                .fontColor('#888888')
            }
          }
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1)
        .margin({ left: 12 })

        // ç®­å¤´
        Text('â€º')
          .fontSize(20)
          .fontColor('#C7C7CC')
      }
      .width('100%')
      .padding({ left: 16, right: 16, top: 12, bottom: 12 })

      // åˆ†å‰²çº¿
      if (!isLast) {
        Divider()
          .color('#EBEBEB')
          .margin({ left: 84 })
      }
    }
    .width('100%')
    .onClick(() => {
      interface RouterParams {
        modeId: string;
        modeName: string;
      }

      const params: RouterParams = {
        modeId: mode.id,
        modeName: mode.name
      };

      router.pushUrl({
        url: 'pages/ChatPage',
        params: params
      });
    })
  }

  @Builder
  FeaturesSection() {
    Column({ space: 0 }) {
      // æ ‡é¢˜
      Column() {
        Text('åŠŸèƒ½ç‰¹ç‚¹')
          .fontSize(13)
          .fontColor('#888888')
      }
      .width('100%')
      .padding({ left: 16, top: 24, bottom: 8 })

      // ç‰¹æ€§åˆ—è¡¨
      Column() {
        this.FeatureItem('ğŸ¯', 'é—®é¢˜æ‹†è§£', 'å¤šè§’è‰²å¸®ä½ åˆ†æé—®é¢˜æœ¬è´¨', false)
        this.FeatureItem('ğŸ’¬', 'æƒ…ç»ªæ”¯æŒ', 'ä¸åªç»™æ–¹æ¡ˆï¼Œä¹Ÿç»™ä½ æƒ…ç»ªä»·å€¼', false)
        this.FeatureItem('âœ…', 'è¡ŒåŠ¨æ¸…å•', 'ç»™å‡ºå¯æ‰§è¡Œçš„å…·ä½“å»ºè®®', true)
      }
      .width('100%')
      .backgroundColor('#FFFFFF')
      .borderRadius(8)
      .margin({ left: 12, right: 12 })
    }
    .width('100%')
  }

  @Builder
  FeatureItem(icon: string, title: string, desc: string, isLast: boolean) {
    Column() {
      Row() {
        Text(icon)
          .fontSize(24)
          .margin({ right: 12 })

        Column({ space: 2 }) {
          Text(title)
            .fontSize(15)
            .fontColor('#000000')

          Text(desc)
            .fontSize(13)
            .fontColor('#888888')
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1)
      }
      .width('100%')
      .padding({ left: 16, right: 16, top: 12, bottom: 12 })

      if (!isLast) {
        Divider()
          .color('#EBEBEB')
          .margin({ left: 52 })
      }
    }
    .width('100%')
  }
}
